### Nyelv ###
$lang_ad_module_not_installed = "!!! Az Active Directory modul nincs telepítve. A program funkciói így működésképtelenek !!!`nKilépés"
$lang_choose = "Válassz"
$lang_choose_err = "Kérlek, csak a megadott lehetőségek közül válassz!"
$lang_file_not_created = "Valami hiba történt, a fájl nem jött létre!"
$lang_object_not_consist = "Az objektum nem tartalmaz tagokat"
$lang_file_is_created = "A fájl létrejött. Helye:"
$lang_id_not_exist = "A megadott azonosító nem létezik"
$lang_reenter_id = "Kérlek add meg újra a lekérdezendő azonosítót`nAzonosító"
$lang_non_existent_ou = "Nem létező OU-t adtál meg"
$lang_enter_ou = "Kérlek add meg a lekérdezni kívánt OU elérési útját!`nElérési út"
$lang_title_admin = "AD Felhasználók és Csoportok - Adminisztrátori mód`n"
$lang_title_user = "AD Felhasználók és Csoportok - Felhasználói mód`n"
$lang_warn_not_admin = "FIGYELEM!!!`nNem admin jogokkal futtatod a programot!`n"
$lang_warn_wont_work = "Bizonyos funkciók így is működni fognak, de csoportok illetve felhasználók módosítására nem lesz jogosultságod."
$lang_warn_run_anyway = "`nHa ennek ellenére is futtatnád a programot, üss Entert"
$lang_main_menu = "Mit szeretnél lekérdezni?`n`n(1) Egy csoporthoz tartozó felhasználókat`n(2) Egy felhasználó csoporttagságait`n(3) Egy OU összes csoportjának tagjait`n(4) Egy OU összes felhasználójának csoporttagságait`n(5) Egy OU számítógépeit, akár aktivitás/inaktivitás ideje szerint szűrve`n(6) Egy OU felhasználóit, akár aktivitás/inaktivitás ideje szerint szűrve"
$lang_enter_group_name = "Kérlek add meg a lekérdezni kívánt csoport nevét!`nCsoportnév"
$lang_i_found = "Megtaláltam a"
$lang_the_group = "csoportot`n"
$lang_found_group = "Csak kiiratni szeretnéd az eredményt, fájlba menteni, vagy egy másik csoporthoz hozzáadni ennek tagjait?`n`n(1) Ha kiíratnád`n(2) Ha fájlba mentetnéd`n(3) Ha másik csoporthoz adnád a tagokat"
$lang_name = "Név"
$lang_description = "Rendfokozat"
$lang_username = "Felhasználónév"
$lang_groups = "Csoportok"
$lang_group_whats_next = "(M) Ha más folyamatot szeretnél futtatni ugyanezzel a forrás csoporttal`n(U) Ha új csoportot szeretnél lekérdezni`n(N) Ha visszalépnél a program elejére`n(Q) Ha kilépnél"
$lang_group_members_copy = "csoport tagjainak másolása"
$lang_enter_target_group = "Kérlek, add meg a csoport nevét, amihez hozzá szeretnéd adni a tagokat!"
$lang_to_group = "csoporthoz."
$lang_copy_of = "másolása"
$lang_task_unsuccesful = "`nA feladat végrehajtása sikertelen!`n"
$lang_you_have_no_rights = "Nincs jogosultságod a"
$lang_to_modify_group = "csoport módosítására"
$lang_task_fully_succesful = "A feladat hibák nélkül futott le."
$lang_copy_groups_whats_next = "(R) Ha hozzá akarnál adni valaki mást is ugyanezekhez a csoportokhoz`n(M) Ha más folyamatot szeretnél futtatni ugyanezzel a forrás csoporttal`n(U) Ha új csoportot szeretnél lekérdezni`n(N) Ha visszalépnél a program elejére`n(Q) Ha kilépnél"
$lang_enter_username = "Kérlek add meg a lekérdezni kívánt felhasználó bejelentkezési nevét!`nAzonosító"
$lang_the_user = "felhasználót, bejelentkezési neve:"
$lang_user_whats_next = "Csak kiiratni szeretnéd az eredményt, fájlba menteni, vagy átmásolnád a csoporttagságait egy másik felhasználóhoz?`n(1) Ha kiíratnád`n(2) Ha fájlba mentetnéd`n(3) Ha más felhasználóhoz másolnád"
$lang_users = "Felhasználók"
$lang_group_name = "Csoportnév"
$lang_s_rights = "jogai"
$lang_users_groups_copy = "felhasználó csoporttagságainak másolása"
$lang_to_user = "felhasználóhoz"
$lang_enter_target_user = "Kérlek add meg a felhasználó nevét, akihez másolni szeretnéd a csoporttagságokat`nAzonosító"
$lang_have_no_rights_to_modify_groups = "Nincs jogosultságod a felhasználó hozzáadására a csoportokhoz!"
$lang_task_ended_with_mistakes = "A feladat lefutott a következő hibákkal:`n"
$lang_user_added = "felhasználó sikeresen hozzáadva"
$lang_to_group_of = "csoporthoz a"
$lang_of_groups = "csoportból.`n"
$lang_copy_users_whats_next = "(R) Ha hozzá akarnál adni valaki mást is ugyanezekhez a csoportokhoz`n(M) Ha más folyamatot szeretnél futtatni ugyanezzel a forrás felhasználóval`n(U) Ha új felhasználót szeretnél lekérdezni`n(N) Ha visszalépnél a program elejére`n(Q) Ha kilépnél"
$lang_all_groups_of_ou = "Egy OU ÖSSZES csoportjának lekérdezése`n"
$lang_no_groups_in_ou = "A megadott OU-ban nincsenek csoportok`n"
$lang_progress = "`nA folyamat állapota:"
$lang_ou_whats_next = "`n(R) Ha más OU-t kérdeznél le`n(N) Ha visszalépnél a program elejére`n(Q) Ha kilépnél a programból"
$lang_all_users_of_ou = "Egy OU ÖSSZES felhasználójának lekérdezése`n"
$lang_no_users_in_ou = "A megadott OU-ban nincsenek felhasználók`n"
$lang_all_computers_of_ou = "Egy OU számítógépeinek lekérdezése`n"
$lang_no_computers_in_ou = "A megadott OU-ban nincsenek számítógépek`n"
$lang_computers = "Számítógépek"
$lang_ou_exist = "A keresett OU létezik`n"
$lang_generic_or_activity_filtered = "Csak egy általános listát kérnél le, vagy aktivitás/inaktivitás ideje szerint is szűrnéd?`n`n(1) Általános lista`n(2) Aktivitás/inaktivitás szerint szűrt lista"
$lang_the = "A(z)"
$lang_computers_of_ou = "OU számítógépek lekérdezése`n"
$lang_how_many_days = "Az elmúlt hány nap során aktív/inaktív objektumokat szeretnéd lekérdezni?`nNapok száma"
$lang_computers_last = "számítógépek elmúlt"
$lang_days_of_activity = "napjának aktivitása`n"
$lang_active_or_inactive = "Az aktív, vagy inaktív gépeket szeretnéd lekérdezni?`n(1) Ha az aktív gépeket`n(2) Ha az inaktív gépeket"
$lang_last = "elmult"
$lang_days_active_pc = "NapbanAktivGepek"
$lang_days_inactive_pc = "NapbanInaktivGepek"
$lang_computername = "Gépnév"
$lang_last_logon = "Utolsó bejelentkezés"
$lang_OS = "Operációs rendszer"
$lang_users_of_ou = "Egy OU felhasználóinak lekérdezése`n"
$lang_ou_users = "OU felhasználók lekérdezése`n"
$lang_users_last = "felhasználók elmúlt"
$lang_days_active_users = "NapbanAktivFelhasznalok"
$lang_days_inactive_users = "NapbanInaktivFelhasznalok"
$lang_users_of = "Felhasználói"

### Functions ###
function OUnevfordito
{
    param($bemenet)
    $kimenet = $bemenet.Split("/")
    
    for ($i = $kimenet.Length-1; $i -gt -1; $i--)
    {
        if ($i -ne 0)
        {
            if ($i -eq $kimenet.Length-1)
            {
                $ounev = $kimenet[$i]
            }
            $forditott += "OU="+ $kimenet[$i]+","
        }
        else 
        {
            $dcnevold = $kimenet[$i]
            $dcnevtemp = $dcnevold.Split(".")
          #  $dcnevtemp
            for ($j = 0; $j -lt $dcnevtemp.Length; $j++)
            {
                if ($j -lt $dcnevtemp.Length-1)
                    {
                        $dcnev += "DC="+$dcnevtemp[$j]+","
                    }
                else 
                    {
                        $dcnev += "DC="+$dcnevtemp[$j]
                    }    
            }
            $forditott += $dcnev
        }
    }    
    return $forditott
}

function OUment
{
    param($bemenet)
    $kimenet = $bemenet.Split(",OU=")
    return $kimenet[3]
}

function Valaszt
{
    param($choice)
    $probalkozottmar = $false
    do
    {        
        if ($probalkozottmar -eq $false)
        {
            $valasztas = Read-Host -Prompt $lang_choose
        }
        else
        {
            Write-Host "`n`n"$lang_choose_err -ForegroundColor Yellow
            $valasztas = Read-Host -Prompt $lang_choose
        }
        $teszt = $false
        for ($i=0; $i -lt $choice.Length; $i++)
        {
            if ($valasztas -eq $choice[$i])
            {
                $teszt = $true
                break
            }
            $probalkozottmar = $true
        }
    } while ($teszt -ne $true)
    return $valasztas
}

function CSVfunkciok
{
    param ($bemenet, $csvout, [bool]$noout)

    if ($null -ne $bemenet)
    {
        try
        {
            $bemenet | export-csv -encoding Unicode -path $csvout -NoTypeInformation
        }
        catch
        {
            if ($noout -eq $false)
            {
                Write-Host "`n"$lang_file_not_created -ForegroundColor Red
            }        
        }
    }
    else
    {
        $lang_object_not_consist | Set-Content $csvout
    }

    if(Test-Path -Path $csvout)
        {
            if ($noout -eq $false)
            {
                Write-Host "`n" $lang_file_is_created $csvout -ForegroundColor Green
            }
                "sep=,`n"+(Get-Content $csvout -Raw) | Set-Content $csvout            
        }
}

function Letezike 
{
    param ($obj)
    do
    {
        if (!(dsquery user -samid $obj) -and !(dsquery group -samid $obj))
            {                
                Write-Host "`n"$lang_id_not_exist "`n" -ForegroundColor Red
                $obj = Read-Host -Prompt $lang_reenter_id
            }
    } while (!(dsquery user -samid $obj) -and !(dsquery group -samid $obj))
    return $obj
}

function OUcheck
{
    param ($eredetiou)
    $ouletezik = $false
    do 
    {
        try
        {            
            $ou = OUnevfordito $eredetiou
            Get-ADOrganizationalUnit -Identity $ou | Out-Null
            $ouletezik = $true
        }
        catch
        {
            Write-Host $lang_non_existent_ou -ForegroundColor Red
            $eredetiou = Read-Host -Prompt $lang_enter_ou
            $ouletezik = $false
        }
    } while ($ouletezik -eq $false)
    return $ou
}

function CSVdir
{
    param ($csvdir)
    if(!(Test-Path -Path $csvdir))
    {
        New-Item -ItemType directory -Path $csvdir | Out-Null
    }    
}


####### Program belépési pont ########

if (!(Get-Module -ListAvailable -Name ADModule)) 
    {
        Write-Host $lang_ad_module_not_installed -ForegroundColor Red
        Read-Host
        break
    } 

# Program címsor
$title = $lang_title_admin

# Administrator jogok ellenőrzése - Ha a felhasználó admin, a normál $title van használva, ha nem admin, sárga színű, és figyelmeztetést kap
$admine = New-Object Security.Principal.WindowsPrincipal([Security.Principal.WindowsIdentity]::GetCurrent())
if (($admine.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) -eq $false)
    {
        cls
        $title = $lang_title_user
        Write-Host $title -ForegroundColor Yellow
        Write-Host $lang_warn_not_admin -ForegroundColor Yellow
        Write-Host $lang_warn_wont_work
        Read-Host -Prompt $lang_warn_run_anyway
    }
else 
    {
        $title
    }

# A program törzsének loopja, ezen belül helyezkedik el az összes lekérdezés
do
{ 
    # A kiválasztandó funkció bekérése #
    cls
    $title
    Write-Host $lang_main_menu
    $mit = Valaszt ("1", "2", "3", "4", "5", "6")


    # A felhasználóval kapcsolatos műveletek #
    cls
    switch ($mit)
    {
    1 # Csoportokkal kapcsolatos műveletek #
        {
            # A csoportokkal kapcsolatos műveletek loopja, ebben helyezkedik el MINDEN csoporttal kapcsolatos művelet, az egy OU összes csoportjának lekérdezésén kívül. Az első loop a csoport nevének megadása ELŐTT kezdődik #
            do
            {
            cls
            $title
            $csopnev = Read-Host -Prompt $lang_enter_group_name
            $csopnev = Letezike $csopnev            

                # Ez a csoport nevének megadását követően induló loop. Ide akkor térünk vissza, ha a felhasználó ugyanezzel a csoporttal akar más műveletet végezni. #
                do
                {
                    # A rendszergazda ellenőrzött megkérdezése az adatokkal elvégzendő műveletről #   
                    cls
                    $title
                    Write-Host $lang_i_found $csopnev $lang_the_group -ForegroundColor Green
                    Write-Host $lang_found_group
                    $kiir = Valaszt ("1", "2", "3")

                    switch ($kiir)
                        {
                            1 # Csoport tagjainak kiírása #
                                {
                                    Get-ADGroupMember -identity $csopnev | Get-ADObject -Properties description, samAccountName | select @{n=$lang_name; e='name'}, @{n=$lang_description; e='description'}, @{n=$lang_username; e='samAccountName'} | Out-String
                                    Write-Host $lang_group_whats_next
                                    $kilep = Valaszt ("M", "N", "U", "Q")
                                }
                            2 # Csoport taglistájának fájlba mentése #
                                {
                                    $csvdir = "D:\AD-Out\$lang_groups"
                                    CSVdir $csvdir

                                    $csvout = "$csvdir\$csopnev.csv"
                                    $ment = Get-ADGroupMember -identity $csopnev | Get-ADObject -Properties description, samAccountName | select @{n=$lang_name; e='name'}, @{n=$lang_description; e='description'}, @{n=$lang_username; e='samAccountName'}
                                    CSVfunkciok $ment $csvout
                                    
                                    Write-Host $lang_group_whats_next
                                    $kilep = Valaszt ("M", "N", "U", "Q")
                                }
                            3 # Csoport tagjainak hozzáadása másik csoporthoz #
                                {
                                    # Legbelső loop, ide akkor térünk vissza, ha a felhasználó ugyanennek a csoportnak a tagjait még más egyéb csoportokhoz is hozzá akarja adni #
                                    do
                                    {
                                        $kitol = Get-ADGroup $csopnev                                        
                                        cls
                                        $title
                                        Write-Host $kitol.name $lang_group_members_copy
                                        # A célcsoport nevének ellenőrzött bekérése #
                                        $newgroup = Read-Host -Prompt $lang_enter_target_group
                                        $newgroup = Letezike $newgroup

                                        # A tagok csoporthoz adásának folyamata #
                                        [array]$members = Get-ADGroupMember $csopnev;
                                        $kihez = Get-ADGroup $newgroup                    
                                        cls
                                        $title
                                        Write-Host $kitol.Name $lang_group_members_copy $kihez.Name $lang_to_group

                                        $elemszam = $members.Count

                                        for ($i=0; $i -lt $elemszam; $i++)
                                            {
                                                # Hibák elkapása #
                                                try
                                                {
                                                    Add-ADGroupMember -Identity $newgroup -Members $members[$i]
                                                    Write-Host "`r$i/"$elemszam $lang_copy_of -NoNewline
                                                }
                                                catch
                                                {                                    
                                                    $hiba = @($newgroup)
                                                }

                                                # Ablak bezáródás előtt a rendszergazda értesítése a folyamat eredményéről #
                                                if ($i -eq $elemszam-1)
                                                {
                                                    # Kigyűjtött hibák kiírása #                                    
                                                    if ($hiba.Count -gt 0)
                                                        {
                                                        cls
                                                        $title
                                                        Write-Host $lang_task_unsuccesful -ForegroundColor Red
                                                        Write-Host $lang_you_have_no_rights $hiba $lang_to_modify_group -ForegroundColor Red
                                                    }
                                                    else
                                                    {
                                                        cls
                                                        $title
                                                        Write-Host $lang_task_fully_succesful -ForegroundColor Green
                                                    }
                                                    Write-Host $lang_copy_groups_whats_next
                                                    $kilep = Valaszt ("M", "N", "Q", "R", "U")
                                                }
                                            }
                                    } while ($kilep -eq "R")                    
                                }
                        }
                } while ($kilep -eq "M")
            } while ($kilep -eq "U")
        }

    2 # Egy felhasználó csoporttagságainak lekérdezése #
        {
            # A felhasználókkal kapcsolatos folyamatok loopja. Ide térünk vissza, ha a folyamat végén az app használója újra felhasználókkal kapcsolatos folyamatot szeretne futtatni.
            do
            {
                cls
                $title
                # A felhasználó nevének ellenőrzött bekérése #
                $username = Read-Host -Prompt $lang_enter_username
                $username = Letezike $username

                # A folyamat ugyanezen felhasználó adatain történő megismétlésének loopja. #
                do
                {
                    # A rendszergazda ellenőrzött megkérdezése az adatokkal elvégzendő műveletről #                
                    cls
                    $title
                    $kitol = Get-ADUser $username 
                    Write-Host $lang_i_found $kitol.name $lang_the_user $username"`n" -ForegroundColor Green
                    Write-Host $lang_user_whats_next
                    $kiir = Valaszt ("1", "2", "3")

                    switch ($kiir)
                    {
                        1 # Csoporttagságok kíírása #
                            {
                                cls
                                $title
                                Get-ADPrincipalGroupMembership $username | select  @{n=$lang_group_name; e='name'}  | Out-String
                                # Az eredmény konzolra kiírása után a felhasználótól a következő lépés bekérése #
                                Write-Host $lang_user_whats_next
                                $kilep = Valaszt ("M", "N", "U", "Q")
                            }
                        2 # Csoporttagságok fájlba mentése #
                            {
                                $csvdir = "D:\AD-Out\$lang_users"
                                CSVdir $csvdir

                                $csvout = "$csvdir\$username-$lang_s_rights.csv"
                                $ment = Get-ADPrincipalGroupMembership $username | select @{n=$lang_group_name; e='name'}
                                CSVfunkciok $ment $csvout                                

                                # Az eredmény konzolra kiírását követően a felhasználótól a következő lépés bekérése #
                                Write-Host $lang_user_whats_next
                                $kilep = Valaszt ("M", "N", "U", "Q")
                            }
                        3 # Csoporttagságok felhasználóhoz másolása #
                            {
                                # A bekért felhasználó több felhasználóhoz másolásának loopja. Ha egy másolás után az app használója úgy dönt, hogy más felhasználóhoz is bemásolná ugyanezeket a tagságokat, ide térünk vissza #
                                do 
                                {
                                    # A célfelhasználó adatainak ellenőrzött bekérése #
                                    cls
                                    $title          
                                    Write-Host $kitol.Name $lang_users_groups_copy
                                    $newuser = Read-Host -Prompt $lang_enter_target_user
                                    $newuser = Letezike $newuser
                                    
                                    # A csoporttagságok másolásának folyamata #
                                    [array]$csopnevek = Get-ADPrincipalGroupMembership $username;
                                    $kihez = Get-ADUser $newuser

                                    $elemszam = $csopnevek.Count

                                    cls
                                    $title
                                    Write-Host $kitol.Name $lang_users_groups_copy $kihez.Name $lang_to_user
                                    for ($i=0; $i -lt $elemszam; $i++)
                                        {
                                            # Hibák elkapása - Van-e jog a csoportokhoz való hozzáadáshoz #
                                            try
                                                {
                                                    Add-ADGroupMember -Identity $csopnevek[$i] -Members $newuser
                                                    Write-Host "`r$i/"$elemszam $lang_copy_of -NoNewline
                                                }
                                            catch
                                                {                                    
                                                    $hiba += @($csopnevek[$i].SamAccountName)
                                                }

                                            # Ablak bezáródás előtt a rendszergazda értesítése a folyamat eredményéről #
                                            if ($i -eq $elemszam-1)
                                                {
                                                    # Kigyűjtött hibák kiírása #
                                                    if ($hiba.Count -gt 0)
                                                    {
                                                        if ($hiba.Count -eq $elemszam)
                                                        {
                                                            cls
                                                            $title
                                                            Write-Host $lang_have_no_rights_to_modify_groups -ForegroundColor Red
                                                        }
                                                        else {                                            
                                                            cls
                                                            $sikeres = $elemszam-$hiba.Count
                                                            $title
                                                            Write-Host $lang_task_ended_with_mistakes -ForegroundColor Yellow
                                                            for ($j=0; $j -lt $hiba.Count; $j++)
                                                                {
                                                                    Write-Host $lang_you_have_no_rights $hiba[$j] $lang_to_modify_group -ForegroundColor Yellow                                                    
                                                                }
                                                            Write-Host $kihez.Name $lang_user_added $sikeres $lang_to_group_of $elemszam $lang_of_groups -ForegroundColor Yellow
                                                            }
                                                        }
                                                    # Üzenet hibátlan eredmény esetén #
                                                    else
                                                        {
                                                            cls
                                                            $title
                                                            Write-Host $lang_task_fully_succesful -ForegroundColor Green
                                                        }
                                                    # Felhasználó megkérdezése a folyamat lefutását követő teendőkről #
                                                    Write-Host $lang_copy_users_whats_next
                                                    $kilep = Valaszt ("R", "M", "N", "Q", "U")
                                                }
                                        }                                        
                                } while ($kilep -eq "R")                                
                            }
                    }
                } while ($kilep -eq "M")
            } while ($kilep -eq "U")
        }

    3 # Egy OU összes csoportjának tagjai #
        {
            do
            {
                cls
                $title
                do
                {
                    Write-Host $lang_all_groups_of_ou
                    $eredetiou = Read-Host -Prompt $lang_enter_ou
                    $ou = OUcheck $eredetiou
                    $ounev = OUment $ou
                
                    $vane = $true
                    [array]$csopnevek = Get-ADGroup -SearchBase $ou -Filter *

                    if($csopnevek.Length -eq 0)
                    {
                        Write-Host $lang_no_groups_in_ou -ForegroundColor Red
                        $vane = $false                        
                    }                    
                } while ($vane -eq $false)

                $elemszam = $csopnevek.Count

                $csvdir = "D:\AD-Out\$lang_groups\$ounev"
                CSVdir $csvdir

                    $progressbar = 100 / $elemszam
                    Write-Host $lang_progress

                    for ($i=0; $i -lt $elemszam; $i++)
                    {
                        $csvname = $csopnevek[$i].name
                        $csvout = "$csvdir\$csvname.csv"
                        
                        $csopnev = Get-ADGroup $csopnevek[$i].samAccountName
                        $ment = Get-ADGroupMember -identity $csopnev | Get-ADObject -Properties description, samAccountName | select @{n=$lang_name; e='name'}, @{n=$lang_description; e='description'}, @{n=$lang_username; e='samAccountName'}
                        CSVfunkciok $ment $csvout $true
                        $percentage = [math]::Round($progressbar * ($i+1))
                        Write-Host "`r$Percentage%" -NoNewline
                    }               
                    
                Write-Host $lang_ou_whats_next
                $kilep = Valaszt ("N", "Q", "R")
            } while ($kilep -eq "R")
        }

    4 # Egy OU minden felhasználójának lekérdezése #
        {
            do
            {
                cls
                $title
                do
                {
                    Write-Host $lang_all_users_of_ou
                    $eredetiou = Read-Host -Prompt $lang_enter_ou
                    $ou = OUcheck $eredetiou
                    $ounev = OUment $ou
                
                    $vane = $true
                    [array]$userek = Get-ADUser -SearchBase $ou -Filter *

                    if($userek.Length -eq 0)
                    {
                        Write-Host $lang_no_users_in_ou -ForegroundColor Red
                        $vane = $false                        
                    }                    
                } while ($vane -eq $false)

                $elemszam = $userek.Count

                $csvdir = "D:\AD-Out\$lang_users\$ounev"
                CSVdir $csvdir

                    $progressbar = 100 / $elemszam
                    Write-Host $lang_progress

                    for ($i=0; $i -lt $elemszam; $i++)
                    {
                        $csvname = $userek[$i].samAccountName
                        $csvout = "$csvdir\$csvname.csv"
                        
                        $username = Get-ADUser $userek[$i].samAccountName
                        $ment = Get-ADPrincipalGroupMembership $username | select @{n=$lang_group_name; e='name'}
                        CSVfunkciok $ment $csvout $true
                        $percentage = [math]::Round($progressbar * ($i+1))
                        Write-Host "`r$Percentage%" -NoNewline
                    }               
                    
                Write-Host $lang_ou_whats_next
                $kilep = Valaszt ("N", "Q", "R")
            } while ($kilep -eq "R")
        }

    5 # Egy OU számítógépei, akár aktivitás/inaktivitás szerint szűrve #
        {
            do
            {
                cls
                $title
                do
                {
                    Write-Host $lang_all_computers_of_ou
                    $eredetiou = Read-Host -Prompt $lang_enter_ou
                    $ou = OUcheck $eredetiou
                    $ounev = OUment $ou                
                    
                    $vane = $true
                    $teszt = Get-ADComputer -Filter * -SearchBase $ou
                    
                    if($teszt.Length -eq 0)
                    {
                        Write-Host $lang_no_computers_in_ou -ForegroundColor Red
                        $vane = $false                        
                    }                    
                } while ($vane -eq $false)

                $csvdir = "D:\AD-Out\$lang_computers"
                CSVdir $csvdir
                
                cls
                $title
                Write-Host $lang_ou_exist -ForegroundColor Green
                Write-Host $lang_generic_or_activity_filtered
                $szurt = Valaszt ("1", "2")
                
                if ($szurt -eq 2)
                {
                    cls
                    $title
                    Write-Host $lang_the $eredetiou $lang_computers_of_ou
                    $napja = Read-Host -Prompt $lang_how_many_days
                    $time = (Get-Date).Adddays(-($napja))

                    cls
                    $title
                    Write-Host $lang_the $eredetiou $lang_computers_last $napja $lang_days_of_activity
                    Write-Host $lang_active_or_inactive
                    $avi = Valaszt ("1", "2")

                    if ($avi -eq "1")
                        {
                            $csvout = "$csvdir\$ounev-$lang_last-$napja-$lang_days_active_pc.csv"
                            $ment = Get-ADComputer -Filter {LastLogonTimeStamp -gt $time} -SearchBase $ou -Properties LastLogonDate, OperatingSystem | select @{n=$lang_computername; e='name'}, @{n=$lang_last_logon;e='LastLogonDate'}, @{n=$lang_OS; e='OperatingSystem'}
                        }
                    else
                        {
                            $csvout = "$csvdir\$ounev-$lang_last-$napja-$lang_days_inactive_pc.csv"
                            $ment = Get-ADComputer -Filter {LastLogonTimeStamp -lt $time} -SearchBase $ou -Properties LastLogonDate, OperatingSystem | select @{n=$lang_computername; e='name'}, @{n=$lang_last_logon;e='LastLogonDate'}, @{n=$lang_OS; e='OperatingSystem'}
                        }
                }
                else
                {
                    cls
                    $title
                    $csvout = "$csvdir\$ounev-OU-$lang_computers.csv"
                    $ment = Get-ADComputer -Filter * -SearchBase $ou -Properties LastLogonDate, OperatingSystem | select @{n=$lang_computername; e='name'}, @{n=$lang_last_logon;e='LastLogonDate'}, @{n=$lang_OS; e='OperatingSystem'}
                }
                CSVfunkciok $ment $csvout
                Write-Host $lang_ou_whats_next
                $kilep = Valaszt ("N", "Q", "R")
            } while ($kilep -eq "R")
        }

    6 # Egy OU felhasználói, akár aktivitás/inaktivitás szerint szűrve #
        {
            cls
            $title
            do
            {

                Write-Host $lang_users_of_ou
                $eredetiou = Read-Host -Prompt $lang_enter_ou
                $ou = OUcheck $eredetiou
                $ounev = OUment $ou

                $vane = $true
                $teszt = Get-ADUser -Filter * -SearchBase $ou

                if($teszt.Length -eq 0)
                    {
                        Write-Host $lang_no_users_in_ou -ForegroundColor Red
                        $vane = $false
                    }                    
            } while ($vane -eq $false)

            $csvdir = "D:\AD-Out\$lang_users"
            CSVdir $csvdir

            cls
            $title
            Write-Host $lang_ou_exist -ForegroundColor Green
            Write-Host $lang_generic_or_activity_filtered
            $szurt = Valaszt ("1", "2")

            if ($szurt -eq 2)
                {
                    cls
                    $title
                    Write-Host $lang_the $eredetiou $lang_ou_users                
                    $napja = Read-Host -Prompt $lang_how_many_days
                    $time = (Get-Date).Adddays(-($napja))

                    cls
                    $title
                    Write-Host $lang_the $eredetiou $lang_users_last $napja $lang_days_of_activity
                    Write-Host $lang_active_or_inactive
                    $avi = Valaszt ("1", "2")

                    if ($avi -eq "1")
                        {
                            $csvout = "$csvdir\$ounev-$lang_last-$napja-$lang_days_active_users.csv"
                            $ment = Get-ADUser -Filter {LastLogonTimeStamp -gt $time} -SearchBase $ou -Properties name, SamAccountName, description, LastLogonDate | select @{n=$lang_name; e='name'}, @{n=$lang_description; e='description'}, @{n=$lang_username; e='samAccountName'}, @{n=$lang_last_logon;e='LastLogonDate'}
                        }
                    else
                        {
                            $csvout = "$csvdir\$ounev-$lang_last-$napja-$lang_days_inactive_users.csv"
                            $ment = Get-ADUser -Filter {LastLogonTimeStamp -lt $time} -SearchBase $ou -Properties name, SamAccountName, description, LastLogonDate | select @{n=$lang_name; e='name'}, @{n=$lang_description; e='description'}, @{n=$lang_username; e='samAccountName'}, @{n=$lang_last_logon;e='LastLogonDate'}
                        }
                }
            else
                {
                    cls
                    $title
                    $csvout = "$csvdir\$ounev-OU-$lang_users_of.csv"
                    $ment = Get-ADUser -Filter * -SearchBase $ou -Properties name, SamAccountName, description, LastLogonDate | select @{n=$lang_name; e='name'}, @{n=$lang_description; e='description'}, @{n=$lang_username; e='samAccountName'}, @{n=$lang_last_logon;e='LastLogonDate'}
                }
            CSVfunkciok $ment $csvout
            Write-Host $lang_ou_whats_next
            $kilep = Valaszt ("N", "Q", "R")
        }
    }
} while ($kilep -ne "Q")